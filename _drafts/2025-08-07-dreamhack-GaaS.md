---
title: "GaaS Write-Up"
description: "[Dreamhack] GaaS Write-Up"
header: "Dreamhack"
lang: ko
---

[문제 링크](https://dreamhack.io/wargame/challenges/2028)

GCM 모드는 CTR 모드를 기반으로 하여 인증 기능이 추가되는 모드이다. 이는 GCM 모드에서 CTR 모드와 동일하게 XOR에 기반한 접근이 상당히 유효함을 의미한다.

본 문제에서 GaaS 인스턴스는 생성될 때 key와 nonce를 생성하며, 이후 이를 갱신하지 않는다.

이런 류의 key, nonce의 재사용이 동일한 keystream을 생성하여 암호화/인증을 수행하고, 문제 풀이의 시작점이 된다.

암호문을 온전히 알 수 있으므로 $tag=f_m(h)h+s$ 꼴의 식을 얻을 수 있다.

이때 $f_m$은 계수를 온전히 알 수 있는 다항식이며 $s$는 key, nonce에만 의존적이므로 각 암호화/인증에서 상수이다.

인수정리를 활용하면 길이가 같은 평문-암호문 쌍을 3개 획득하면 $s$를 소거하여 $(x-h)$를 인수로 갖는 두 다항식을 계산할 수 있다.

두 다항식의 gcd를 계산하면 높은 확률로 유일한 $(x-h)$의 후보를 계산할 수 있고, 이를 다시 대입하여 $s$를 계산할 수 있다.

다만 flag를 얻기 위해 위조해야 하는 메세지의 길이가 입력 길이 제한보다 짧으므로, 알 수 있는 keystream의 길이가 모자르다.

이를 해결하기 위해서 입력 json이 바이트열로 인코딩된 후 암호화되며 길이 검사는 그 이전에 발생함에 주목해야 한다.

ASCII 인코딩은 ascii code 128 미만의 문자만 수용하는데, \x7f 등의 문자는 인코딩 시 여러 바이트로 인코딩된다.

가능한 모든 문자 중 \x7f가 가장 많은 수의 바이트로 인코딩되므로, 이를 통해 필요한 keystream을 전부 획득할 수 있다.